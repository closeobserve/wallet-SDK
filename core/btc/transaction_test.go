package btc

import (
	"bytes"
	"encoding/hex"
	"github.com/btcsuite/btcd/btcutil/psbt"
	"github.com/coming-chat/wallet-SDK/core/testcase"
	"github.com/stretchr/testify/require"
	"reflect"
	"testing"
)

func TestExtractPsbtToMsgTx(t *testing.T) {
	type args struct {
		psbtTx string
	}
	tests := []struct {
		name    string
		args    args
		want    string
		wantErr bool
	}{
		{
			name: "test case 1",
			args: args{
				psbtTx: "70736274ff0100fd1e110100000001d49552f36d9ff754b475f8ec5e1822774dbcdb67a1af4e19b75852193b6f367a0100000000fdffffff655107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec93cc6000000000000160014ca1ebc2823e9c38ff36084c1320b751ba7b656c6000000000001011f5e5f040000000000160014ca1ebc2823e9c38ff36084c1320b751ba7b656c6220203772da2fda340de5e187408332d7df123607b6e4d1e2ebd16c466b59f9342086647304402207aa0580f0a9dfd055971c8dd0d2d990a157f80babfa9287d29df82430d74942b02204ad28739a9a1ebcae43a3e8b86845533b2cc5313052f242b4bc4118e1e37b23101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
			},
			want:    "01000000000101d49552f36d9ff754b475f8ec5e1822774dbcdb67a1af4e19b75852193b6f367a0100000000fdffffff655107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec95107000000000000225120372f0e143e77f952b62aaa2ea8ff75ca752ad27860b421f4d51fd0a7e9d63ec93cc6000000000000160014ca1ebc2823e9c38ff36084c1320b751ba7b656c60247304402207aa0580f0a9dfd055971c8dd0d2d990a157f80babfa9287d29df82430d74942b02204ad28739a9a1ebcae43a3e8b86845533b2cc5313052f242b4bc4118e1e37b231012103772da2fda340de5e187408332d7df123607b6e4d1e2ebd16c466b59f9342086600000000",
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			got, err := ExtractPsbtToMsgTx(tt.args.psbtTx)
			if (err != nil) != tt.wantErr {
				t.Errorf("ExtractPsbtToMsgTx() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			b := bytes.NewBuffer([]byte{})
			err = got.Serialize(b)
			require.NoError(t, err)
			if !reflect.DeepEqual(hex.EncodeToString(b.Bytes()), tt.want) {
				t.Errorf("ExtractPsbtToMsgTx() got = %v, want %v", got, tt.want)
			}
		})
	}
}

func TestSignPSBTTx(t *testing.T) {
	type args struct {
		tx      *psbt.Packet
		account *Account
	}
	tests := []struct {
		name    string
		args    args
		wantErr bool
	}{
		{
			name: "test for segwit v0",
			args: args{
				tx:      getPsbtPacketWithSegwitV0(t),
				account: testAccount(t),
			},
			wantErr: false,
		},
		{
			name: "test for segwit v1",
			args: args{
				tx:      getPsbtPacketWithSegwitV1(t),
				account: testAccount(t),
			},
			wantErr: false,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if err := SignPSBTTx(tt.args.tx, tt.args.account); (err != nil) != tt.wantErr {
				t.Errorf("SignPSBTTx() error = %v, wantErr %v", err, tt.wantErr)
			}
		})
	}
}

func testAccount(t *testing.T) *Account {
	account, err := NewAccountWithMnemonic(testcase.M1, "testnet")
	require.NoError(t, err)
	address, err := account.TaprootAddress()
	t.Log(address.Value)
	segwitAddress, err := account.NativeSegwitAddress()
	require.NoError(t, err)
	t.Log(segwitAddress.Value)
	return account
}

func getPsbtPacketWithSegwitV0(t *testing.T) *psbt.Packet {
	packet, err := DecodePsbtTxToPacket("70736274ff01007d010000000158d38c41272f90e01d8dd3c5f9f6c4d37892ddcbaee155ecd826113c163003700000000000fdffffff02ea0500000000000022512073c9f2168a01fb0f0caa8a3fb7889ce4ab2cec67bfb16d272af4eea91fbd83e011cc240000000000160014f23a59a174bf387281535e2c0f6a395b77eb04a3000000000001011f2dd3240000000000160014f23a59a174bf387281535e2c0f6a395b77eb04a3000000")
	require.NoError(t, err)
	return packet
}

func getPsbtPacketWithSegwitV1(t *testing.T) *psbt.Packet {
	packet, err := DecodePsbtTxToPacket("70736274ff0100b20100000002140af55e79fd4273fec16f597e148477340f6d03901b45bdf00d9dcc094dbfd40100000000fdfffffff7c67b76c3b94c30388fd49af18527511f721d01b48f8b2e1c56b1e6ca9855290000000000fdffffff02400500000000000022512049ad748ab7aea7493344af621351c28db2e5fbc979ec635e3eb4f025d41600c2140b030000000000225120bab7dd449084f708daf74e7e6511ec796bf3071e9fc56c812712329d1a1c7d84000000000001012be803000000000000225120bab7dd449084f708daf74e7e6511ec796bf3071e9fc56c812712329d1a1c7d840001012b400d030000000000225120bab7dd449084f708daf74e7e6511ec796bf3071e9fc56c812712329d1a1c7d84000000")
	require.NoError(t, err)
	return packet
}
